<?php/** * Implements hook_menu(). */function physical_entity_form_statement_menu() {    $items['physical-entities/form-statements/create'] = array(        'title' => 'Create Statement Form',        'page callback' => 'physical_entity_form_statement_page',        'access callback' => TRUE,    );  return $items;}/** * hook_menu() callback * * @return array|mixed */function physical_entity_form_statement_page() {    return drupal_get_form('physical_entity_form_statement_form');}/** * Implements hook_form(). * @param $form * @param $form_state * @return * @internal param $form_state */function physical_entity_form_statement_form($form, &$form_state) {    $physical_entities_obj = physical_entity_form_statement_get_physical_entities();    $physical_entities = array();    $personal_id_numbers = array();    foreach($physical_entities_obj as $physical_entity_obj) {        $physical_entities[$physical_entity_obj->nid] =            $physical_entity_obj->field_first_name['und'][0]['value'] . ' '.$physical_entity_obj->field_last_name['und'][0]['value'];        $personal_id_numbers[$physical_entity_obj->nid] = $physical_entity_obj->field_personal_id_number['und'][0]['value'];    }    $form['personal_id_number_input'] = array(        '#type' => 'textfield',        '#title' => t('Personal ID Numbers'),        '#maxlength' => 11,        '#default' => '',    );    $form['personal_id_numbers'] = array(        '#type' => 'select',        '#options' => $personal_id_numbers,        '#required' => TRUE,        '#default' => '',    );    $form['physical_entity'] = array(        '#type' => 'select',        '#title' => t('Physical Entities'),        '#options' => $physical_entities,        '#required' => TRUE,        '#default' => '',    );    $form['principal_amount'] = array(        '#type' => 'textfield',        '#title' => t('Principal Amount'),        '#required' => TRUE,        '#default' => '',    );    $currency = array(        'USD' => 'USD',        'GEL' => 'GEL',    );    $form['currency'] = array(        '#type' => 'select',        '#title' => t('Currency'),        '#options' => $currency,        '#required' => TRUE,        '#default' => '',    );    $form['principal_amount'] = array(        '#type' => 'textfield',        '#title' => t('Principal Amount'),        '#required' => TRUE,        '#default' => '',    );    $annual_interest_rates = array(        '18' => 18,        '30' => 30,        'Other' => 'Other'    );    $form['annual_interest_rate'] = array(        '#type' => 'select',        '#title' => t('Annual Interest Rate'),        '#options' => $annual_interest_rates,        '#required' => TRUE,        '#default' => '',    );    $form['interest_rate_other'] = array(        '#type' => 'textfield',        '#title' => t('Other Interest Rate'),        '#default' => '',    );//    $form['issue_date'] = array(//        '#type' => 'date_popup',//        '#date_format' => 'Y-m-d',//        '#date_label_position' => 'within',//        '#title' => t('Date'),//        '#required' => TRUE,//        '#default' => '',//    );    $payment_period_types = array(        'Yearly' => 'Yearly',        'Semiannually' => 'Semiannually',        'Quarterly' => 'Quarterly',        'Monthly' => 'Monthly'    );    $form['payment_period_type'] = array(        '#type' => 'select',        '#title' => t('Payment Period Type'),        '#options' => $payment_period_types,        '#required' => TRUE,        '#default' => '',    );    $form['number_of_periods'] = array(        '#type' => 'textfield',        '#title' => t('Number of Periods'),        '#required' => TRUE,        '#default' => '',    );    $form['loan_number'] = array(        '#type' => 'textfield',        '#title' => t('Loan Number'),        '#value' => uniqid('#'),        '#required' => TRUE,        '#default' => '',    );    $form['principal_amount_fine'] = array(        '#type' => 'textfield',        '#title' => t('Principal Amount Fine'),        '#required' => TRUE,        '#default' => '',    );    $form['interest_rate_fine'] = array(        '#type' => 'textfield',        '#title' => t('Interest Rate Fine'),        '#required' => TRUE,        '#default' => '',    );    $form['grace_period'] = array(        '#type' => 'textfield',        '#title' => t('Grace Period'),        '#required' => TRUE,        '#default' => '',    );    $repayment_schedule_types = array(        'Discount Rate' => 'Discount Rate'    );    $form['repayment_schedule_type'] = array(        '#type' => 'select',        '#title' => t('Repayment Schedule Type'),        '#options' => $repayment_schedule_types,        '#required' => TRUE,        '#default' => '',    );    $form['submit'] = array(        '#type' => 'submit',        '#value' => t('Submit'),    );    return $form;}/** * Implements hook_form_validate() * * @param $form * @param $form_state *///function physical_entity_form_statement_form_validate($form, &$form_state) {//}/** * Implements hook_form_submit() * * @param $form * @param $form_state */function physical_entity_form_statement_form_submit($form, &$form_state) {    $node = new stdClass();    $node->type = 'physical_entity_loan';    $node->title = $form_state['values']['loan_number'];    node_object_prepare($node);    $node->language = LANGUAGE_NONE;    $node->field_physical_entity[$node->language][] = array(        'target_id' => $form_state['values']['physical_entity'],        'target_type' => 'node',    );    $node->field_principal_amount[$node->language] = array(        0 => array('value' => $form_state['values']['principal_amount'])    );    $node->field_currency[$node->language] = array(        0 => array('value' => $form_state['values']['currency'])    );    $node->field_annual_interest_rate[$node->language] = array(        0 => array('value' => $form_state['values']['annual_interest_rate'])    );    $node->field_annual_interest_rate_other[$node->language] = array(        0 => array('value' => $form_state['values']['interest_rate_other'])    );    $node->field_date[$node->language] = array(        0 => array('value' => date('Y-m-d'))    );    $node->field_payment_period_type[$node->language] = array(        0 => array('value' => $form_state['values']['payment_period_type'])    );    $node->field_number_of_periods[$node->language] = array(        0 => array('value' => $form_state['values']['number_of_periods'])    );    $node->field_loan_number[$node->language] = array(        0 => array('value' => $form_state['values']['loan_number'])    );    $node->field_principal_amount_fine[$node->language] = array(        0 => array('value' => $form_state['values']['principal_amount_fine'])    );    $node->field_interest_rate_fine[$node->language] = array(        0 => array('value' => $form_state['values']['interest_rate_fine'])    );    $node->field_grace_period[$node->language] = array(        0 => array('value' => $form_state['values']['grace_period'])    );    $node->field_repayment_schedule_type[$node->language] = array(        0 => array('value' => $form_state['values']['repayment_schedule_type'])    );    $node = node_submit($node);    node_save($node);    drupal_set_message("Statement form saved successfully!");}/** * Implements hook_node_validate(). * @param $node * @param $form * @param $form_state */function physical_entity_form_statement_node_validate($node, $form, &$form_state) {    $loan_status_id = $form_state['values']['field_loan_status']['und'][0]['target_id'];    $statement_form = physical_entity_form_statement_get_statement_form_by_nid($node->nid);    foreach($statement_form as $sf) {        $loan_status_id_db = $sf->field_loan_status['und'][0]['target_id'];        if ($loan_status_id_db == 10 && $loan_status_id != $loan_status_id_db) {            form_set_error('field_loan_status', t("Loan has already been issued"));        }    }}function physical_entity_form_statement_get_statement_form_by_nid($nid) {    $query = new EntityFieldQuery();    $query->entityCondition('entity_type', 'node')        ->entityCondition('bundle', 'physical_entity_loan')        ->propertyCondition('nid', $nid);    $result = $query->execute();    $statement_form = array();    if (isset($result['node'])) {        $statement_form = entity_load('node', array_keys($result['node']));    }    return $statement_form;}/** * Get all physical entities * * @return array|bool|mixed */function physical_entity_form_statement_get_physical_entities() {    $query = new EntityFieldQuery();    $query->entityCondition('entity_type', 'node')        ->entityCondition('bundle', 'physical_entity');    $result = $query->execute();    $physical_entities = array();    if (isset($result['node'])) {        $physical_entities_nids = array_keys($result['node']);        $physical_entities = entity_load('node', $physical_entities_nids);    }    return $physical_entities;}/** * @param $loan_status * @return */function physical_entity_form_statement_get_fa_icon($loan_status) {    $loan_status_icons = [      'Pending' => 'fa fa-clock-o pending',      'Approved' => 'fa fa-check-circle approved',      'Rejected' => 'fa fa-ban rejected',      'Issued' => 'fa fa-check-circle issued',    ];    return $loan_status_icons[$loan_status];}